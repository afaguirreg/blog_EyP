<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8">
		<title>Documento sin título</title>
		<link rel="stylesheet" type="text/css" href="../../../0 - styles/mystyles.css">
		<script language="JavaScript" src="../../../0 - scripts/myscripts.js"></script>
		<script language="JavaScript" src="https://yui-s.yahooapis.com/3.18.1/build/yui/yui-min.js"></script>
		<script type="text/javascript" src="../../../0 - scripts/jquery/jquery.min.js"></script>
		<script type="text/javascript" src="../../../0 - scripts/iframe/iframeResizer.min.js"></script>
	</head>

	<body class="yui3-skin-sam" onload="capturar();">
		<div class="Normal" style="text-align:justify">
			<a id="Entradas analogas"></a>
			<b>9. Entradas análogas</b>
			<br><br>
			<iframe class="pag" id="ifrm1" name="ifrm1" scrolling="no" src="../../html/9.%20Entradas%20analogas.html"></iframe>
			<br>
			<iframe class="pag" id="ifrm2" name="ifrm2" scrolling="no" src="../html/9.%20Entradas%20analogas.html"></iframe>
			<br><br><br>
			<a id="Lectura convertidor Analogo / Digital"></a>
			<b><i>9.1 Lectura convertidor Análogo / Digital</i></b>
			<br><br>
			Como ejemplo del uso del conversor ADC del microcontrolador vamos a utilizar las funciones para leer el dato proveniente de un sensor en el rango de 0 a 5V y representar en un display LCD el valor leído por el convertidor ADC en el rango de 0 a 1023.
			<br><br>
			<div align="center">
				<table width="512" style="border-radius: 25px;border: 6px solid #000000;background: #0080FF;">
					<tbody>
						<tr>
							<td width="200">
								<div align="center" id="demo1"></div>
								<div><br></div>
								<div><br></div>
							</td>
							<td>
								<div align="center"><b>Voltaje</b></div>
								<div align="center"><input style="width:96px" class="panel" id="voltaje1" value="0.000 V" disabled></div>
							</td>
							<td>
								<div align="center"><b>ADC</b></div>
								<div align="center"><input style="width:96px" class="panel" id="ADC1" value="0" disabled></div>
							</td>
						</tr>
					</tbody>
				</table>
			</div>
			<script>
				YUI().use('dial', function(Y) {
					var dial = new Y.Dial( {
						min: -2.5,
						max: 2.5,
						minorStep: 0.001,
						majorStep: 0.001,
						stepsPerRevolution: 6,
						value: -2.5,
						decimalPlaces: 3,
						strings: {label:'', resetStr:'Reset', tooltipHandle:''},
					});
					dial.render('#demo1');

					// Function to update the text input value from the Dial value
					function updateInput( e ) {
						var val = e.newVal;
						if (isNaN(val)) {
							// Not a valid number.
							return;
						}
						this.set("value", parseFloat(val + 2.5).toFixed(3) + " V");
						document.getElementById("ADC1").value = parseInt((val + 2.5) * 1023 / 5) ;
					}

					var theInput = Y.one( "#voltaje1" );

					// Subscribe to the Dial's valueChange event, passing the input as the 'this'
					dial.on("valueChange", updateInput, theInput);
				});
			</script>
			<br>
			<video controls controlslist="nodownload" preload="preload" loop>
				<source src="../video/9.1%20Lectura%20convertidor%20An%C3%A1logo_Digital.webm" type="video/webm">
			</video>
			<br>
			<iframe class="pag" id="ifrm3" name="ifrm3" scrolling="no" src="html/9.1.html"></iframe>
			<br>
			Comentarios del programa:
			<br><br>
			El ejemplo está debidamente documentado, por lo cual su comprensión no reviste mayor dificultad.
			<br><br>
			Se debe tener especial atención al seleccionar elcanal a leer:
			<br><br>
			analogRead(A0); esta instrucción selecciona elcanal AN0
			<br>
			analogRead(A1); esta instrucción selecciona elcanal AN1
			<br>
			analogRead(A2); esta instrucción selecciona elcanal AN2… etc…
			<br><br>
			Esta instrucción lee elvalor análogo en el canal seleccionado previamente
			<br><br>
			Para observar la variación de la unidad medida se hadispuesto un potenciómetro comosensor.
			<br><br>
			Extraído parcialmente de: <a href="http://picmania.garcia-cuervo.net/conceptos.php#CONVAD01">http://picmania.garcia-cuervo.net/conceptos.php#CONVAD01</a>
			<br><br><br>
			<a id="Escalamiento de lectura analogica (Formula)"></a>
			<strong><em>9.2 Escalamiento de lectura analógica (Fórmula)</em></strong>
			<br><br>
			<div align="center">
			<table width="512" style="border-radius: 25px;border: 6px solid #000000;background: #0080FF;">
				<tbody>
					<tr>
						<td width="200">
							<div align="center" id="demo2"></div>
							<div><br></div>
							<div><br></div>
						</td>
						<td>
							<div><br></div>
							<div align="center"><b>Voltaje</b></div>
							<div align="center"><input style="width:96px" class="panel" id="voltaje2" value="0.000 V" disabled></div>
							<div><br></div>
							<div align="center"><b>Smax</b></div>
							<div align="center"><input type="number" style="width:96px" class="panel" id="Smax" value="1023" min="-9999" max="9999" onchange="capturar();"></div>
							<div><br></div>
							<div align="center"><b>Smin</b></div>
							<div align="center"><input type="number" style="width:96px" class="panel" id="Smin" value="0" min="-9999" max="9999" onchange="capturar();"></div>
							<div><br></div>
						</td>
						<td>
							<div><br></div>
							<div align="center"><b>ADC</b></div>
							<div align="center"><input style="width:96px" class="panel" id="ADC2" value="0" disabled></div>
							<div><br></div>
							<div align="center"><b>Salida</b></div>
							<div align="center"><input style="width:96px" class="panel" id="Salida" value="0" disabled></div>
							<div><br></div>
						</td>
					</tr>
				</tbody>
			</table>
			</div>
			<script>
				YUI().use('dial', function(Y) {
					var dial = new Y.Dial( {
						min: -2.5,
						max: 2.5,
						minorStep: 0.001,
						majorStep: 0.001,
						stepsPerRevolution: 6,
						value: -2.5,
						decimalPlaces: 3,
						strings: {label:'', resetStr:'Reset', tooltipHandle:''},
					});
					dial.render('#demo2');

					// Function to update the text input value from the Dial value
					function updateInput( e ) {
						var val = e.newVal;
						if (isNaN(val)) {
							// Not a valid number.
							return;
						}
						this.set("value", parseFloat(val + 2.5).toFixed(3) + " V");
						document.getElementById("ADC2").value = parseInt((val + 2.5) * 1023 / 5) ;
						var Smax = parseFloat(document.getElementById("Smax").value) ;
						var Smin = parseFloat(document.getElementById("Smin").value) ;
						document.getElementById("Salida").value = parseFloat((val + 2.5) * (Smax - Smin) / 5 + Smin).toFixed(1) ;
					}

					var theInput = Y.one( "#voltaje2" );

					// Subscribe to the Dial's valueChange event, passing the input as the 'this'
					dial.on("valueChange", updateInput, theInput);
				});
			</script>
			<br>
			<i>ADC</i> = <i>Voltaje</i> *
			<div class="fraction">
				<span class="fup">1023</span>
				<span class="bar">/</span>
				<span class="fdn">Vdd (5V)</span>
			</div>
			<br><br>
			<i>Salida</i> = <i>ADC</i> *
			<div class="fraction">
				<span class="fup">(Smax - Smin)</span>
				<span class="bar">/</span>
				<span class="fdn">1023</span>
			</div> + Smin
			<br><br>
			<i>Salida</i> = <i>ADC</i> *
			<div class="fraction">
				<span class="fup">(<span id="Ymax"></span><span id="Ymin1"></span>)</span>
				<span class="bar">/</span>
				<span class="fdn">1023</span>
			</div>
			<span id="Ymin2"></span>
			<br><br><br>
			Línea de código Arduino
			<br><br>
			sensor = <i>analogRead(A0);</i>
			<br><br>
			<span id="Sensor"></span><span id="Por"></span>
			<div class="fraction">
				<span class="fup"><span id="Rango"></span></span>
				<span class="bar"><span id="Barra"></span></span>
				<span class="fdn"><span id="Denominador"></span></span>
			</div>
			<span id="Span"></span>
			<script>
				function capturar() {
					var Smax=document.getElementById("Smax").value
					var Smin=document.getElementById("Smin").value
					ejercicio1(Smin, Smax);
					var rango = Smax - Smin;
					if (Smax==1023 && Smin==0) {
						document.getElementById("Sensor").innerHTML = "";
						document.getElementById("Por").innerHTML = "";
						document.getElementById("Rango").innerHTML = "";
						document.getElementById("Barra").innerHTML = "";
						document.getElementById("Denominador").innerHTML = "";
						document.getElementById("Span").innerHTML = "";
					}
					else
					{
						document.getElementById("Sensor").innerHTML = "sensor = sensor ";
						document.getElementById("Por").innerHTML = " * ";
						document.getElementById("Rango").innerHTML = rango;
						document.getElementById("Barra").innerHTML = "/";
						document.getElementById("Denominador").innerHTML = "1023";
					}
					if (Smin>=0) {
						document.getElementById("Ymin1").innerHTML = " - " + Smin;
						document.getElementById("Ymin2").innerHTML = " + " + Smin;
					}
					else {
						document.getElementById("Ymin1").innerHTML = " + " + -Smin;
						document.getElementById("Ymin2").innerHTML = " - " + -Smin;
					}
					if (Smin==0 && Smax!=1023) {
						document.getElementById("Span").innerHTML = ";";
					}
					if (Smin>0) {
						document.getElementById("Span").innerHTML = " + " + Smin + ";";
					}
					if (Smin<0) {
						document.getElementById("Span").innerHTML = " - " + -Smin + ";";
					}
					if (rango==1023 && Smin>0) {
						document.getElementById("Por").innerHTML = " + " + Smin + ";"
						document.getElementById("Rango").innerHTML = "";
						document.getElementById("Barra").innerHTML = "";
						document.getElementById("Denominador").innerHTML = "";
						document.getElementById("Span").innerHTML = "";
					}
					if (rango==1023 && Smin<0) {
						document.getElementById("Sensor").innerHTML = "sensor = sensor ";
						document.getElementById("Por").innerHTML = " - " + -Smin + ";";
						document.getElementById("Rango").innerHTML = "";
						document.getElementById("Barra").innerHTML = "";
						document.getElementById("Denominador").innerHTML = "";
						document.getElementById("Span").innerHTML = "";
					}
					document.getElementById("Ymax").innerHTML = Smax;
				}
			</script>
			<br><br>
			<div class="dibujo-canvas" align="center">
				<canvas id="lienzo1" display="block" color="blue" width="1000" height="512"></canvas>
					<script type="text/javascript">
						ejercicio1(0,1023);
						function ejercicio1(y1, y2) {
							ej1=document.getElementById("lienzo1");
							lienzo1=ej1.getContext("2d");
							lienzo1.clearRect(0,0,1000,512);
							lienzo1.fillStyle = "#EEEEEE";
							lienzo1.fillRect(200, 0, 600, 512);
							lienzo1.lineWidth=2;
							lienzo1.strokeStyle = '#000';
							//EJE X
							lienzo1.beginPath();
							lienzo1.moveTo(200,256);
					lienzo1.lineTo(800,256);
					lienzo1.stroke();
					lienzo1.closePath();
					//EJEY
					lienzo1.beginPath();
					lienzo1.moveTo(200,0);
					lienzo1.lineTo(200,512);
					lienzo1.stroke();
					lienzo1.closePath();
					//DRAW SCALE
					lienzo1.lineWidth=1;
					lienzo1.strokeStyle = '#BBBBBB';
					lienzo1.beginPath(); 
					for (var i=200;i<=800;i+=120) {
						lienzo1.moveTo(i,0);
						lienzo1.lineTo(i,512);
					}
					for (var i=0;i<=512;i+=128) {
						lienzo1.moveTo(200,i);
						lienzo1.lineTo(800,i);
					}
					lienzo1.stroke();
					lienzo1.closePath();
					lienzo1.strokeStyle = '#000000';
					lienzo1.beginPath(); 
					for (var i=200;i<=800;i+=60) {
						lienzo1.moveTo(i,250);
						lienzo1.lineTo(i,262);
					}
					for (var i=0;i<=512;i+=64) {
						lienzo1.moveTo(194,i);
						lienzo1.lineTo(206,i);
					}
					lienzo1.stroke();
					lienzo1.closePath();
					//DRAW 0 - 1023
					if (Math.abs(y1)<=1023 && y2<=1023) {
						lienzo1.lineWidth=1;
						lienzo1.strokeStyle = '#FF0000';
						lienzo1.beginPath();
						lienzo1.moveTo(200,256);
						lienzo1.lineTo(800,0);
						lienzo1.stroke();
						lienzo1.closePath();
						lienzo1.font = "15px Arial";
						lienzo1.fillStyle = '#FF0000';
						lienzo1.beginPath();
						lienzo1.fillText("x:0 y:0", 135, 260);
						lienzo1.fillText("x:5 y:1023", 820, 12);
						lienzo1.stroke();
						lienzo1.closePath();
						lienzo1.strokeStyle = '#0000FF';
						lienzo1.beginPath();
						lienzo1.moveTo(200,256-y1/1023*256);
						lienzo1.lineTo(800,256-y2/1023*256);
						lienzo1.stroke();
						lienzo1.closePath();
						lienzo1.fillStyle = '#0000FF';
						lienzo1.font = "15px Arial";
						lienzo1.fillText("x:0" + " y:" + y1, 60, 260-y1/1023*244);
						lienzo1.fillText("x:5" + " y:" + y2, 910, 268-y2/1023*256);
						lienzo1.stroke();
						lienzo1.closePath();
					}
					else if (Math.abs(y1)<=y2) {
						lienzo1.lineWidth=1;
						lienzo1.strokeStyle = '#FF0000';
						lienzo1.beginPath();
						lienzo1.moveTo(200,256);
						lienzo1.lineTo(800,256-1023/y2*256);
						lienzo1.stroke();
						lienzo1.closePath();
						lienzo1.font = "15px Arial";
						lienzo1.fillStyle = '#FF0000';
						lienzo1.beginPath();
						lienzo1.fillText("x:0 y:0", 135, 260);
						lienzo1.fillText("x:5 y:1023", 820, 268-1023/y2*256);
						lienzo1.stroke();
						lienzo1.closePath();
						lienzo1.lineWidth=1;
						lienzo1.strokeStyle = '#0000FF';
						lienzo1.moveTo(200,256-y1/y2*256);
						lienzo1.lineTo(800,0);
						lienzo1.stroke();
						lienzo1.closePath();
						lienzo1.fillStyle = '#0000FF';
						lienzo1.font = "15px Arial";
						lienzo1.fillText("x:0" + " y:" + y1, 60, 260-y1/y2*244);
						lienzo1.fillText("x:5" + " y:" + y2, 910, 12);
						lienzo1.stroke();
						lienzo1.closePath();
					}
					else if (Math.abs(y1)>y2) {
						lienzo1.lineWidth=1;
						lienzo1.strokeStyle = '#FF0000';
						lienzo1.beginPath();
						lienzo1.moveTo(200,256);
						lienzo1.lineTo(800,256-1023/Math.abs(y1)*256);
						lienzo1.stroke();
						lienzo1.closePath();
						lienzo1.font = "15px Arial";
						lienzo1.fillStyle = '#FF0000';
						lienzo1.beginPath();
						lienzo1.fillText("x:0 y:0", 135, 260);
						lienzo1.fillText("x:5 y:1023", 820, 268-1023/-y1*256);
						lienzo1.stroke();
						lienzo1.closePath();
						lienzo1.lineWidth=1;
						lienzo1.strokeStyle = '#0000FF';
						lienzo1.moveTo(200,512);
						lienzo1.lineTo(800,256+y2/y1*256);
						lienzo1.stroke();
						lienzo1.closePath();
						lienzo1.fillStyle = '#0000FF';
						lienzo1.font = "15px Arial";
						lienzo1.fillText("x:0" + " y:" + y1, 60, 504);
						lienzo1.fillText("x:5" + " y:" + y2, 910, 268+y2/y1*256);
						lienzo1.stroke();
						lienzo1.closePath();
					}
				}
			</script>
			</div>
			<br><br>
			<a id="Escalamiento sin desplazamiento de cero. Rango 0 a 100"></a>
			<b><i>9.2.1 Escalamiento sin desplazamiento de cero. Rango 0 a 100</i></b>
			<br><br>
			<a id="Representación con cifra entera"></a>
			<b><i>9.2.1.1 Representación con cifra entera</i></b>
			<br><br>
			En el siguiente ejemplo haremos que el programa lea una entrada entre 0 y 5V de manera que para 0V representará 0 unidades y 5V representará 100 unidades.
			<br><br>
			<video controls controlslist="nodownload" preload="preload" loop>
				<source src="../video/9.2.1.1 Representación con cifra entera.webm" type="video/webm">
			</video>
			<br>
			<iframe class="pag" id="ifrm4" name="ifrm4" scrolling="no" src="html/9.2.1.1.html"></iframe>
			<br>
			<a id="Representación con dígitos decimales"></a>
			<b><i>9.2.1.2 Representación con dígitos decimales</i></b>
			<br><br>
			En el siguiente ejemplo haremos que el programa lea una entrada entre 0 y 5V de manera que para 0V representará 0 unidadesy 5V representará 100 unidades (con dígitos decimales).
			<br><br>
			<video controls controlslist="nodownload" preload="preload" loop>
				<source src="../video/9.2.1.2 Representación con dígitos decimales.webm" type="video/webm">
			</video>
			<br>
			<iframe class="pag" id="ifrm5" name="ifrm5" scrolling="no" src="html/9.2.1.2.html"></iframe>
			<br><br>
			<a id="Escalamiento con desplazamiento positivo. Rango 20 a 80"></a>
			<b><i>9.2.2 Escalamiento con desplazamiento positivo. Rango 20 a 80</i></b>
			<br><br>
			En el siguiente ejemplo haremos que el programa lea una entrada entre 0 y 5V de manera que para 0V representará 20 unidades y 5V representará 80 unidades.
			<br><br>
			<video controls controlslist="nodownload" preload="preload" loop>
				<source src="../video/9.2.2%20Escalamiento%20con%20desplazamiento%20positivo_20_80.webm" type="video/webm">
			</video>
			<br>
			<iframe class="pag" id="ifrm6" name="ifrm6" scrolling="no" src="html/9.2.2.html"></iframe>
			<br>
			<a id="Escalamiento con desplazamiento negativo. Rango -50 a 150"></a>
			<b><i>9.2.3 Escalamiento con desplazamiento negativo. Rango -50 a 150</i></b>
			<br><br>
			En el siguiente ejemplo haremos que el programa lea una entrada entre 0 y 5V de manera que para 0V representará -50 unidades y 5V representará 150 unidades.
			<br><br>
			<video controls controlslist="nodownload" preload="preload" loop>
				<source src="../video/9.2.3%20Escalamiento%20con%20desplazamiento%20negativo_-50_150.webm" type="video/webm">
			</video>
			<br>
			<iframe class="pag" id="ifrm7" name="ifrm7" scrolling="no" src="html/9.2.3.html"></iframe>
			<br><br>
			<a id="Funcion map para escalamiento de lectura analogica"></a>
			<b><i>9.3 Función map para escalamiento de lectura analógica</i></b>
			<br><br>
			<video controls controlslist="nodownload" preload="preload" loop>
				<source src="../video/9.3 Funcion map para escalamiento de lectura analogica.webm" type="video/webm">
			</video>
			<br>
			<iframe class="pag" id="ifrm8" name="ifrm8" scrolling="no" src="html/9.3.html"></iframe>
		</div>
		<script type="text/javascript">
			/*
			* If you do not understand what the code below does, then please just use the
			* following call in your own code.
			*
			*iFrameResize({log:true});
			*
			* Once you have it working, set the log option to false.
			*/
			iFrameResize({
				log: true, // Enable console logging
				inPageLinks: true,
				onResized: function(messageData) {
					// Callback fn when resize is received
					$('p#callback').html('<b>Frame ID:</b> ' + messageData.iframe.id + ' <b>Height:</b> ' + messageData.height + ' <b>Width:</b> ' + messageData.width + ' <b>Event type:</b> ' + messageData.type)
				},
				onMessage: function(messageData) {
					// Callback fn when message is received
					$('p#callback').html('<b>Frame ID:</b> ' + messageData.iframe.id + ' <b>Message:</b> ' + messageData.message)
					alert(messageData.message)
					document.getElementsByTagName('iframe')[0].iFrameResizer.sendMessage('Hello back from parent page')
				},
				onClosed: function(id) {
					// Callback fn when iFrame is closed
					$('p#callback').html('<b>IFrame (</b>' + id + '<b>) removed from page.</b>')
				}
			})
		</script>
	</body>
</html>