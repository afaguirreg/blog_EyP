<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8">
		<title>Documento sin título</title>
		<link rel="stylesheet" type="text/css" href="../0 - styles/mystyles.css">
		<script language="JavaScript" src="../0 - scripts/myscripts.js"></script>
	</head>

	<body>
		<div class="Normal" style="text-align:justify">
			<b><i>Diseño de Interfaces para automatización con C# y Mfg Advanced HMI Controls</i></b>
			<br><br>
			Cree un nuevo proyecto, agregue y modifique las propiedades de los controles necesarios para obtener una interfaz visual similar a la mostrada en la imagen.
			<br><br>
			<div align="center"><img src="img/3.4_1.png" alt="" width="auto" height="auto"></div>
			<br>
			Sugerencia: pruebe cambiando el valor de las propiedades y verificando si cambia el aspecto visual de los controles en la ventana, por ejemplo, color y tamaño de texto.
			<br><br>
			Puede descargar la librería de controles y utilizarlas para diseñar esta interfaz:
			<br><br>
			<a href="https://drive.google.com/uc?id=1SnwTyCkjbCGldzgo9pCmft6ogRuHhy6s&export=download&authuser=0" target="_blank">https://drive.google.com/uc?id=1SnwTyCkjbCGldzgo9pCmft6ogRuHhy6s&amp;export=download&amp;authuser=0</a>
			<br><br>
			<b><i>Nota</i></b>: Copiar el archivo descargado <b><i>MfgControl.AdvancedHMI.Controls.dll</i></b> a la unidad C: \ del sistema.
			<br><br>
			Como instalar la librería de controles
			<br><br>
			<div align="center">
				<video controls controlslist="nodownload" preload="preload" loop>
					<source src="video/4 - AdvancedHMI.webm" type="video/webm">
				</video>
			</div>
			<br>
			Es posible que se requiera la re-configuración de la plataforma .NET para poder ejecutar la aplicación desarrollada con la librería de controles.
			<br><br>
			<div align="center">
				<video controls controlslist="nodownload" preload="preload" loop>
					<source src="video/5 - Configuración.webm" type="video/webm">
				</video>
			</div>
			<br><br>
			<b><i>Añadiendo código a la aplicación</i></b>
			<br><br>
			La configuración de la interfaz visual de la aplicación nos permite establecer el aspecto que tendrá el programa para el usuario final, pero detrás de ésta interfaz hay un código que define el &ldquo;comportamiento&rdquo; del programa, que es la manera en que procesa la información y controla cuando debe hacerlo.
			<br><br>
			<b><i>Eventos</i></b>
			<br><br>
			Un evento es un mensaje que envía un objeto cuando ocurre una acción. La acción podría ser causada por la interacción del usuario, como un clic del botón, o podría ser iniciado por otra lógica de programa, como cambiar un valor de propiedad.
			<br>
			El uso más habitual para los eventos se produce en las interfaces gráficas; normalmente, las clases que representan controles de la interfaz disponen de eventos que se notifican cuando el usuario hace algo con el control (por ejemplo, hacer clic en un botón).
			<br><br>
			El objeto que provoca el evento se conoce como <b><i>emisor del evento</i></b>. El evento normalmente es un miembro del emisor del evento; por ejemplo, el evento <b><i>Click</i></b> es un miembro de la clase <b><i>Button</i></b>.
			<br><br>
			Los eventos, sin embargo, no sólo se utilizan para interfaces gráficas. Los eventos proporcionan un medio apropiado para que los objetos puedan señalizar cambios de estado que pueden resultar útiles para los clientes de ese objeto. Los eventos constituyen unidades importantes para crear clases que se pueden reutilizar en diferentes programas.
			<br><br>
			En una aplicación de formularios Windows Forms en C# típica, se suscribe a eventos generados por controles como botones, cajas de texto y cuadros de lista. Puede utilizar el entorno de desarrollo integrado (IDE) de C# para examinar los eventos que publica un control y seleccionar los que desea controlar. El IDE agrega automáticamente un método de control de eventos vacío y el código para suscribirse al evento.
			<br><br>
			Para acceder a la lista de eventos de un control se debe seleccionar y hacer click en el ícono <b><i>events</i></b> de la ventana <b><i>Properties</i></b>.
			<br><br>
			<div align="center">
				<video controls controlslist="nodownload" preload="preload" loop>
					<source src="video/6 - Button.webm" type="video/webm">
				</video>
			</div>
			<br>
			La palabra al lado del nombre del objeto nos indica cual es el evento. El evento <b><i>Click</i></b> ocurre cuando el control Button detecta que se ha pulsado el botón izquierdo del mouse sobre él. Para éste caso se ha programado que se active el control waterPump1, lo cual hará que cambie de color.
			<br><br>
		  <div align="center"><img src="img/3.4_2.png" alt="" width="auto" height="auto"></div>
			<br>
			Como puede ver, el uso de los eventos es muy intuitivo. Para lograr que el programa se comporte tal y como usted desea, debe haber definido claramente cuando y como desea que ocurran las acciones de control sobre las variables y objetos sobre la ventana.
			<br><br>
			Explorar las propiedades de los controles ubicados en la interfaz gráfica de la aplicación y programar el evento Click de los botones para lograr un funcionamiento de la aplicación como el mostrado:
			<br><br>
			<div align="center">
				<video controls controlslist="nodownload" preload="preload" loop>
					<source src="video/7 - Llenar_Vaciar.webm" type="video/webm">
				</video>
			</div>
			<br>
			Continuando con nuestro proyecto, vamos a declarar las variables que almacenarán el valor numérico del estado del proceso.
			<br><br>
			<div align="center"><img src="img/3.4_3.png" alt="" width="auto" height="auto"></div>
			<br><br>
			<b><i>Objeto Timer</i></b>
			<br><br>
			El objeto Timer permite ejecutar tareas repetitivas en un intervalo de tiempo definido.
			<br><br>
			Para comprobar su funcionamiento vamos a desarrollar el código para que las variables del proceso en nuestra aplicación se incrementen en intervalos de tiempo regulares.
			<br><br>
			Ubicar un objeto Timer en la ventana de proyecto.
			<br><br>
			<div align="center"><img src="img/3.4_4.png" alt="" width="auto" height="auto"></div>
			<br>
			En las propiedades del control <b><i>timer1</i></b> hallaremos la propiedad <b><i>enabled</i></b> que permite habilitar el evento de ocurrencia a intervalos regulares y la propiedad <b><i>interval</i></b> que permite definir el tiempo de intervalo en milisegundos (100 ms = 0,1 segundo)
			<br><br>
			Habilitaremos el control <b><i>timer1</i></b> en el evento <b><i>Click</i></b> del Boton1
			<br><br>
			<div align="center"><img src="img/3.4_5.png" alt="" width="auto" height="auto"></div>
			<br>
			Y en el evento Tick del control timer1 escribiremos las instrucciones necesarias para asignar el valor de las variables al control respectivo y para hacer que se incremente su valor.
			<br><br>
			<div align="center"><img src="img/3.4_6.png" alt="" width="auto" height="auto"></div>
			<br>
			Verificamos el funcionamiento de la aplicación:
			<br><br>
			Nota: Puede modificar el valor de la propiedad <b><i>Interval</i></b> para aumentar o disminuir la velocidad de llenado.
			<br><br>
			<div align="center">
				<video controls controlslist="nodownload" preload="preload" loop>
					<source src="video/8 - Incremento.webm" type="video/webm">
				</video>
			</div>
			<br>
			La animación de los controles refleja el funcionamiento esperado, pero, seguramente ya identificó el problema. El timer1 continúa incrementando el valor de las variables y rebasa el valor máximo de 100.
			<br><br><br>
			<b><i>Estructura if y else</i></b>
			<br><br>
			Apliquemos su principio a nuestro proyecto.
			<br><br>
			<div align="center"><img src="img/3.4_7.png" alt="" width="auto" height="auto"></div>
			<br>
			Modifique el proyecto programando el evento Click de los botones para lograr un funcionamiento de la aplicación como el mostrado.
			<br><br>
			Nota: Puede incluir un segundo control timer para llevar el control de vaciado del tanque.
			<br><br>
			<div align="center">
				<video controls controlslist="nodownload" preload="preload" loop>
					<source src="video/9 - If.webm" type="video/webm">
				</video>
			</div>
			<br><br>
			<b><i>Sonidos</i></b>
			<br><br>
			En ocasiones puede resultar útil reproducir sonidos en nuestra aplicación.
			<br><br>
			Adicionaremos a nuestro proyecto el código necesario para darle la capacidad de reproducir un sonido de alarma cuando la presión sobrepase un determinado valor.
			<br><br>
			Agregar la siguiente línea:
			<br><br>
			<div align="center"><img src="img/3.4_8.png" alt="" width="auto" height="auto"></div>
			<br>
			<div align="center"><img src="img/3.4_9.png" alt="" width="auto" height="auto"></div>
			<br>
			Agregar un nuevo control <b><i>Timer</i></b> y programar el evento <b><i>Tick</i></b> con las siguientes líneas de código:
			<br><br>
			<div align="center"><img src="img/3.4_10.png" alt="" width="auto" height="auto"></div>
			<br>
			Descargue el archivo de sonido alarma.wav y cópielo a la unidad D:\ del sistema
			<br><br>
			<a href="https://drive.google.com/uc?id=1SYRTQDdjEvdu53ZlYzQAaEjj0_s-cEuU&export=download&authuser=0" target="_blank">https://drive.google.com/uc?id=1SYRTQDdjEvdu53ZlYzQAaEjj0_s-cEuU&amp;export=download&amp;authuser=0</a>
			<br><br>
			Configurar las propiedades del nuevo control Timer con los siguientes parámetros:
			<br><br>
			<div align="center"><img src="img/3.4_11.png" alt="" width="auto" height="auto"></div>
			<br>
			<div align="center">
				<video controls controlslist="nodownload" preload="preload" loop>
					<source src="video/10 - Alarma.m4v" type="video/mp4">
				</video>
			</div>
			<br><br>
			<b><i>Almacenar registro de variables en un archivo</i></b>
			<br><br>
			Los sistemas de monitoreo por computador son aplicaciones de software diseñadas con la finalidad de controlar y supervisar procesos y permiten al usuario recolectar datos de una o más instalaciones distribuidas y/o enviar comandos y órdenes a estas instalaciones. Además, envían la información generada en el proceso productivo a diversos usuarios, tanto del mismo nivel como hacia otros supervisores dentro de la empresa, es decir, que permite la participación de otras áreas como, por ejemplo:
			<br><br>
			Control de calidad, supervisión, mantenimiento, etc.
			<br><br>
			Vamos a desarrollar la programación para que nuestra aplicación adquiera la característica de poder almacenar en un archivo el estado de las variables por intervalos de tiempo, de manera que se pueda verificar su comportamiento a través del tiempo.
			<br><br>
			Incluir los espacios System.IO y System.Text como muestra la imagen.
			<br><br>
			<div align="center"><img src="img/3.4_12.png" alt="" width="auto" height="auto"></div>
			<br>
			Insertar un control Timer adicional y programar el evento Tick.
			<br><br>
			<div align="center"><img src="img/3.4_13.png" alt="" width="1000" height="auto"></div>
			<br>
			La instrucción crea un nuevo FileStream, que abre la conexión con el archivo especificado en el primer parámetro.
			<br><br>
			Para información adicional sobre esta instrucción, visitar el siguiente enlace:
			<br><br>
			<a href="https://msdn.microsoft.com/es-es/library/system.io.file%28v=vs.110%29.aspx">https://msdn.microsoft.com/es-es/library/system.io.file%28v=vs.110%29.aspx</a>
			<br><br>
			La Línea de datos a almacenar debe contener las variables en formato de cadena de texto separadas por punto y coma &ldquo;;&rdquo;, esto permite que cada dato se almacene en una celda diferente en el archivo.
			<br><br>
			El formato de archivo almacenado es CSV.
			<br><br>
			Los archivos CSV (del inglés comma-separated values) son un tipo de documento en formato abierto sencillo para representar datos en forma de tabla, en las que las columnas se separan por punto y coma.
			<br><br>
			Ejecutar el programa por un periodo de tiempo y después cerrarlo para verificar los datos almacenados.
			<br><br>
			<b><i>Nota importante</i></b>: El archivo de registro debe estar cerrado al momento de ejecutar la aplicación, ya que si está abierto nuestro programa no podrá escribir datos en él.
			La ruta donde se guardará el archivo es D:\Registro.csv
			<br><br>
			Al abrir nuevamente el archivo Registro.csv encontraremos los datos recolectados durante el lapso de tiempo que el programa estuvo ejecutándose.
			<br><br>
			<div align="center"><img src="img/3.4_14.png" alt="" width="auto" height="auto"></div>
			<br><br>
			<b><i>Crear una ventana Splash Screen</i></b>
			<br><br>
			Una ventana Splash Screen es aquella que se despliega por unos segundos cuando se inicia un programa.
			<br><br>
			Para crear una ventana Splash Screen en nuestro proyecto, vamos a agregar un nuevo ítem como muestra la imagen:
			<br><br>
			<div align="center"><img src="img/3.4_15.png" alt="" width="auto" height="auto"></div>
			<br>
			Seleccionamos el ítem Form y le damos el nombre Splash Screen.cs
			<br><br>
			<div align="center"><img src="img/3.4_16.png" alt="" width="auto" height="auto"></div>
			<br>
			Agregamos un control Timer a la ventana Splash Screen:
			<br><br>
			<div align="center"><img src="img/3.4_17.png" alt="" width="auto" height="auto"></div>
			<br>
			En las propiedades del control Timer habilitamos el control con la función enabled = true y definimos el intervalo de tiempo en milisegundos (4000ms = 4 segundos)
			<br><br>
			<div align="center"><img src="img/3.4_18.png" alt="" width="auto" height="auto"></div>
			<br>
			Podemos configurar el aspecto de la ventana de acuerdo al proyecto desarrollado, definiendo imagen, color, texto, etc.
			<br><br>
			<div align="center"><img src="img/3.4_19.png" alt="" width="auto" height="auto"></div>
			<br>
			<div align="center"><img src="img/3.4_20.png" alt="" width="auto" height="auto"></div>
			<br>
			Finalmente, adicionamos código al evento Tick del control Timer1 para definir el comportamiento deseado (ocultar la ventana Splash Screen y mostrar la siguiente ventana cuando hayan transcurrido 4 segundos).
			<br><br>
			<div align="center"><img src="img/3.4_21.png" alt="" width="auto" height="auto"></div>
			<br>
			Hacemos doble click en Program.cs, en el explorador de proyectos y nos aseguramos de que el objeto inicial del proyecto será la nueva ventana Splash Screen:
			<br><br>
			<div align="center"><img src="img/3.4_22.png" alt="" width="auto" height="auto"></div>
			<br>
			Podemos configurar una nueva ventana para cumplir la función de login a usuarios:
			<br><br>
			<div align="center"><img src="img/3.4_23.png" alt="" width="auto" height="auto"></div>
			<br>
			<div align="center"><img src="img/3.4_24.png" alt="" width="auto" height="auto"></div>
			<br>
			Para establecer si el usuario y contraseña ingresados son válidos vamos a programar el evento Click del control Button1
			<br><br>
			<div align="center"><img src="img/3.4_25.png" alt="" width="auto" height="auto"></div>
			<br>
			<div align="center"><img src="img/3.4_26.png" alt="" width="auto" height="auto"></div>
			<br>
			Reprogramar el evento Click del control Button1 para que, en lugar de avisar mediante un texto si el usuario es válido, nos lleve a una nueva ventana donde se verá la interfaz gráfica del proyecto.
			<br><br>
			Nota: la ventana de login de usuario se debe cerrar cuando se abra la ventana de interfaz gráfica.
		</div>
	</body>
</html>